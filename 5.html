<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>To You: Sky Storybook</title>
    <style>
        body {
            background: #020101; 
            margin: 0;
            overflow: hidden;
            font-family: "Yu Mincho", "SimSun", "Songti SC", serif;
        }
        canvas { display: block; }
        #letter-container {
            position: absolute; top: 50%; left: 0; width: 100%;
            transform: translateY(-50%); text-align: center;
            pointer-events: none; z-index: 10;
        }
        #text-display {
            color: rgba(255, 245, 220, 0.9); 
            font-size: min(5vw, 28px); font-weight: 300;
            letter-spacing: 0.4em; opacity: 0;
            filter: blur(12px); transform: scale(0.95);
            transition: all 3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            text-shadow: 0 0 10px rgba(255,255,255,0.2);
        }
        #text-display.visible { opacity: 1; filter: blur(0px); transform: scale(1); }
        #start-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #020101; display: flex; flex-direction: column;
            justify-content: center; align-items: center; color: #777;
            letter-spacing: 4px; cursor: pointer; transition: opacity 2s; z-index: 20;
        }
        .start-btn {
            border-bottom: 1px solid #333; padding-bottom: 10px; transition: all 0.5s;
        }
        .start-btn:hover { color: #ffaaaa; border-color: #ffaaaa; }
    </style>
</head>
<body>

    <div id="start-overlay">
        <div class="start-btn">ç‚¹å‡»å¼€å¯ Â· å¤©ç©ºç»˜æœ¬</div>
        <p style="font-size: 12px; margin-top: 20px; opacity: 0.4;">å»ºè®®ä½©æˆ´è€³æœº Â· å…¨å±è§‚çœ‹</p>
    </div>
    <div id="letter-container"><div id="text-display"></div></div>
    <canvas id="canvas"></canvas>

<script>
    // ==============================================
    // ğŸ’Œ ä½ çš„ä¿¡ (é…åˆå¯çˆ±çš„å½¢çŠ¶)
    // ==============================================
    const LETTER = [
        "å˜¿ï¼Œä½ çœ‹",
        "æˆ‘æŠŠå¤©ç©ºå˜æˆäº†ä¸€æœ¬ç”»å†Œ",
        "è¿™é‡Œæœ‰ä½ å–œæ¬¢çš„å°å…”å­",
        "æœ‰è—åœ¨äº‘é‡Œçš„èƒ¡èåœ",
        "è¿˜æœ‰æœˆäº®å’Œæ˜Ÿæ˜Ÿ",
        "æ‰€æœ‰çš„ç«¥è¯",
        "éƒ½ä¸ºä½ ç»½æ”¾",
        "æ„¿ä½ æ°¸è¿œä¿æŒç«¥å¿ƒ",
        "æ°¸è¿œå¯çˆ±",
        "â¤"
    ];
    // ==============================================

    const CONFIG = {
        launchSpeed: 13,
        gravity: 0.04,    // é‡åŠ›ç¨å¾®å°ä¸€ç‚¹ï¼Œè®©å½¢çŠ¶ä¿æŒä¹…ä¸€ç‚¹
        friction: 0.95,   
        trailLength: 0.08,
        baseParticleCount: 400 
    };

    const random = (min, max) => Math.random() * (max - min) + min;

    // ==============================================
    // ğŸ¨ å›¾æ¡ˆç”Ÿæˆç®—æ³• (æ ¸å¿ƒ)
    // ==============================================
    const ShapePatterns = {
        // 1. â­ æ˜Ÿæ˜Ÿ (Star)
        star: (count) => {
            const data = [];
            const points = 5;
            for (let i = 0; i < count; i++) {
                const t = (i / count) * Math.PI * 2;
                // å°–è§’é€»è¾‘
                const r = (Math.floor(t / (Math.PI / points)) % 2 === 0) ? 12 : 5;
                const scale = 1.2;
                data.push({ vx: r * Math.cos(t) * scale, vy: r * Math.sin(t) * scale });
            }
            return data;
        },

        // 2. â¤ å¿ƒå½¢ (Heart)
        heart: (count) => {
            const data = [];
            const actualCount = count * 1.2;
            for (let i = 0; i < actualCount; i++) {
                const t = (i / actualCount) * Math.PI * 2;
                const x = 16 * Math.pow(Math.sin(t), 3);
                const y = -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));
                data.push({ vx: x * 0.6, vy: y * 0.6 });
            }
            return data;
        },

        // 3. ğŸŒ™ æœˆäº® (Moon)
        moon: (count) => {
            const data = [];
            for (let i = 0; i < count; i++) {
                // ç”»ä¸€ä¸ªå¤§åœ†å¼§
                const angle = random(0.5, 5.8); // ä¸é—­åˆ
                const x = Math.cos(angle) * 10;
                const y = Math.sin(angle) * 10;
                // åªä¿ç•™æœˆç‰™éƒ¨åˆ†ï¼ˆé€šè¿‡è·ç¦»å‰”é™¤ï¼‰
                data.push({ vx: x, vy: y });
                // è¡¥å……å†…éƒ¨å¡«å……ï¼Œè®©æœˆç‰™æ›´åšå®
                if (i % 3 === 0) {
                    data.push({ vx: x * 0.9 + 1, vy: y * 0.9 }); 
                }
            }
            return data;
        },

        // 4. ğŸŒ¹ ç«ç‘° (Rose Curve)
        rose: (count) => {
            const data = [];
            const k = 4; // 4ç“£ç«ç‘°
            for (let i = 0; i < count; i++) {
                const theta = (i / count) * Math.PI * 2;
                const r = 10 * Math.cos(k * theta);
                data.push({ vx: r * Math.cos(theta), vy: r * Math.sin(theta) });
            }
            return data;
        },

        // 5. ğŸ¥• èƒ¡èåœ (Carrot)
        carrot: (count) => {
            const data = [];
            // èƒ¡èåœèº«ä½“ï¼šå€’ä¸‰è§’/åœ†é”¥
            for (let i = 0; i < count * 0.8; i++) {
                const y = random(0, 15); // é«˜åº¦
                const width = (15 - y) / 2.5; // ä¸‹é¢çª„ä¸Šé¢å®½
                const x = random(-width, width);
                data.push({ vx: x, vy: y - 5, colorHue: 30 }); // æ©™è‰²ä¸»ä½“åç§»
            }
            // èƒ¡èåœå¶å­
            for (let i = 0; i < count * 0.2; i++) {
                const angle = random(Math.PI + 0.5, Math.PI * 2 - 0.5);
                const r = random(2, 6);
                data.push({ 
                    vx: Math.cos(angle) * r, 
                    vy: Math.sin(angle) * r - 6, // æ”¾åœ¨å¤´é¡¶
                    colorHue: 120 // ç»¿è‰²
                }); 
            }
            return data;
        },

        // 6. ğŸ° å°å…”å­ (Rabbit)
        rabbit: (count) => {
            const data = [];
            // å¤´ (åœ†)
            for (let i = 0; i < count * 0.5; i++) {
                const angle = random(0, Math.PI * 2);
                const r = random(0, 6);
                data.push({ vx: Math.cos(angle) * r, vy: Math.sin(angle) * r });
            }
            // è€³æœµ (ä¸¤ä¸ªé•¿æ¤­åœ†)
            const drawEar = (offsetX, angleOffset) => {
                for (let i = 0; i < count * 0.25; i++) {
                    const t = random(0, Math.PI * 2);
                    // æ¤­åœ†æ–¹ç¨‹
                    let x = 2 * Math.cos(t);
                    let y = 6 * Math.sin(t);
                    // æ—‹è½¬
                    const rot = angleOffset;
                    const rx = x * Math.cos(rot) - y * Math.sin(rot);
                    const ry = x * Math.sin(rot) + y * Math.cos(rot);
                    data.push({ vx: rx + offsetX, vy: ry - 7 }); // æ”¾åœ¨å¤´é¡¶ä¸¤ä¾§
                }
            };
            drawEar(-3, -0.2); // å·¦è€³
            drawEar(3, 0.2);   // å³è€³
            return data;
        },

        // 7. ğŸ± çŒ«å’ª (Cat) - AIè¡¥å……
        cat: (count) => {
            const data = [];
            // è„¸
            for (let i = 0; i < count * 0.6; i++) {
                const a = random(0, Math.PI*2);
                const r = random(5, 7);
                data.push({vx: Math.cos(a)*r, vy: Math.sin(a)*r + 2});
            }
            // è€³æœµ (ä¸‰è§’å½¢)
            const addTri = (ox, oy) => {
                for(let i=0; i<count * 0.15; i++) {
                    const w = random(-2, 2);
                    const h = random(0, -4);
                    data.push({vx: w + ox, vy: h + oy});
                }
            }
            addTri(-5, -2);
            addTri(5, -2);
            return data;
        },

        // 8. ğŸ¦‹ è´è¶ (Butterfly) - AIè¡¥å……
        butterfly: (count) => {
            const data = [];
            for (let i = 0; i < count; i++) {
                const t = (i / count) * Math.PI * 12; // å¤šåœˆä»¥å¡«å……
                // è´è¶æ›²çº¿æ–¹ç¨‹
                const r = Math.exp(Math.cos(t)) - 2*Math.cos(4*t) - Math.pow(Math.sin(t/12), 5);
                const scale = 3;
                data.push({
                    vx: Math.sin(t) * r * scale,
                    vy: -Math.cos(t) * r * scale // ä¿®æ­£æ–¹å‘
                });
            }
            return data;
        },

        // 9. ğŸ™‚ ç¬‘è„¸ (Smiley) - AIè¡¥å……
        smiley: (count) => {
            const data = [];
            // è„¸è½®å»“
            for (let i = 0; i < count * 0.6; i++) {
                const a = (i/(count*0.6)) * Math.PI * 2;
                data.push({vx: Math.cos(a)*10, vy: Math.sin(a)*10});
            }
            // çœ¼ç›
            for (let i = 0; i < 20; i++) {
                data.push({vx: -3 + random(-1,1), vy: -3 + random(-1,1)}); // å·¦çœ¼
                data.push({vx: 3 + random(-1,1), vy: -3 + random(-1,1)});  // å³çœ¼
            }
            // å˜´å·´ (ä¸‹åŠåœ†)
            for (let i = 0; i < count * 0.2; i++) {
                const a = random(0.5, 2.6); // å¼§åº¦èŒƒå›´
                data.push({vx: Math.cos(a)*6, vy: Math.sin(a)*6 + 1});
            }
            return data;
        }
    };


    const AudioSys = {
        ctx: null,
        init() { try { const AC = window.AudioContext || window.webkitAudioContext; this.ctx = new AC(); this.ctx.resume(); } catch(e){} },
        playLaunch() {
            if (!this.ctx) return;
            const t = this.ctx.currentTime; const osc = this.ctx.createOscillator(); const gain = this.ctx.createGain();
            osc.frequency.setValueAtTime(150, t); osc.frequency.exponentialRampToValueAtTime(500, t + 2);
            gain.gain.setValueAtTime(0.1, t); gain.gain.linearRampToValueAtTime(0, t + 2);
            osc.connect(gain).connect(this.ctx.destination); osc.start(); osc.stop(t + 2.5);
        },
        playExplosion() {
            if (!this.ctx) return;
            const t = this.ctx.currentTime;
            const bufferSize = this.ctx.sampleRate * 2.0; 
            const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) data[i] = (Math.random()*2-1) * Math.pow(1 - i/bufferSize, 3);
            const noise = this.ctx.createBufferSource(); noise.buffer = buffer;
            const filter = this.ctx.createBiquadFilter(); filter.type = 'lowpass';
            filter.frequency.setValueAtTime(600, t); filter.frequency.exponentialRampToValueAtTime(100, t + 1.5);
            const gain = this.ctx.createGain(); gain.gain.setValueAtTime(1.0, t); gain.gain.exponentialRampToValueAtTime(0.01, t + 2);
            noise.connect(filter).connect(gain).connect(this.ctx.destination); noise.start();
        }
    };

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let w, h, scaleFactor = 1; 
    let particles = []; let rockets = [];
    function resize() { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; scaleFactor = Math.min(w, 1200) / 1200; }
    window.addEventListener('resize', resize); resize();

    // --- ç²’å­ç±» ---
    class Particle {
        constructor(x, y, baseHue, vx, vy, customHue) {
            this.x = x; this.y = y;
            this.lx = x; this.ly = y;
            this.vx = vx * scaleFactor;
            this.vy = vy * scaleFactor;
            
            // å¦‚æœå›¾æ¡ˆæŒ‡å®šäº†ç‰¹æ®Šé¢œè‰²(å¦‚èƒ¡èåœå¶å­)ï¼Œç”¨ç‰¹æ®Šé¢œè‰²ï¼Œå¦åˆ™ç”¨çƒŸèŠ±ä¸»è‰²
            this.hue = customHue !== undefined ? customHue : baseHue + random(-10, 10);
            
            this.brightness = random(60, 95);
            this.alpha = 1;
            this.decay = random(0.005, 0.01); // è¡°å‡é€‚ä¸­ï¼Œå½¢çŠ¶æ¸…æ™°
            this.lineWidth = random(1.2, 2.5);
        }

        update() {
            this.lx = this.x; this.ly = this.y;
            this.vx *= CONFIG.friction;
            this.vy *= CONFIG.friction;
            this.vy += CONFIG.gravity; 
            // ä¿æŒå½¢çŠ¶ï¼šæ‰°åŠ¨æå°
            this.vx += random(-0.02, 0.02);
            this.vy += random(-0.02, 0.02);
            this.x += this.vx; this.y += this.vy;
            this.alpha -= this.decay;
        }

        draw(ctx) {
            ctx.beginPath(); ctx.moveTo(this.lx, this.ly); ctx.lineTo(this.x, this.y);
            let currentHue = this.hue; if (this.alpha < 0.3) currentHue = 0;
            const color = `hsla(${currentHue}, 100%, ${this.brightness}%, ${this.alpha})`;
            ctx.strokeStyle = color; ctx.lineWidth = this.lineWidth; ctx.lineCap = 'round'; ctx.stroke();
        }
    }

    class Rocket {
        constructor(targetY, callback) {
            this.x = w / 2; this.y = h; this.targetY = targetY; this.vy = -CONFIG.launchSpeed;
            this.callback = callback; this.trail = []; AudioSys.playLaunch();
        }
        update() {
            this.x += random(-0.5, 0.5); this.y += this.vy; this.vy *= 0.98;
            this.trail.push({x: this.x, y: this.y}); if(this.trail.length > 12) this.trail.shift();
            if (this.vy > -1 || this.y <= this.targetY) { this.callback(this.x, this.y); return false; }
            return true;
        }
        draw(ctx) {
            ctx.beginPath(); for(let i=0; i<this.trail.length-1; i++) { ctx.moveTo(this.trail[i].x, this.trail[i].y); ctx.lineTo(this.trail[i+1].x, this.trail[i+1].y); }
            ctx.strokeStyle = `rgba(255, 220, 150, 0.8)`; ctx.lineWidth = 2; ctx.stroke();
        }
    }

    let letterIndex = 0; let isPlaying = false;
    function startShow() {
        if(isPlaying) return; isPlaying = true;
        const ov = document.getElementById('start-overlay'); ov.style.opacity = 0;
        setTimeout(() => ov.remove(), 2000);
        AudioSys.init(); setTimeout(nextSequence, 1000);
    }
    function nextSequence() {
        if (letterIndex >= LETTER.length) { setInterval(launchRandom, 3500); return; }
        rockets.push(new Rocket(h * 0.25, (x, y) => {
            explode(x, y); showText(LETTER[letterIndex]); letterIndex++;
            setTimeout(nextSequence, 7000);
        }));
    }
    function launchRandom() { rockets.push(new Rocket(h * random(0.2, 0.4), (x, y) => explode(x, y))); }

    // --- çˆ†ç‚¸æ§åˆ¶ ---
    function explode(x, y) {
        AudioSys.playExplosion();
        const baseHue = random(0, 360);
        
        // éšæœºé€‰æ‹©ä¸€ä¸ªå½¢çŠ¶
        const shapeNames = Object.keys(ShapePatterns);
        const chosenShape = shapeNames[Math.floor(random(0, shapeNames.length))];
        const particleData = ShapePatterns[chosenShape](CONFIG.baseParticleCount);

        particleData.forEach(data => {
            // å¦‚æœå½¢çŠ¶å‡½æ•°è¿”å›äº† colorHueï¼Œåˆ™ä½¿ç”¨å®ƒï¼ˆä¾‹å¦‚èƒ¡èåœçš„æ©™è‰²å’Œç»¿è‰²ï¼‰
            // å¦åˆ™ä½¿ç”¨çƒŸèŠ±æœ¬æ¬¡çš„åŸºç¡€é¢œè‰²
            particles.push(new Particle(x, y, baseHue, data.vx, data.vy, data.colorHue));
        });
    }

    const textEl = document.getElementById('text-display');
    function showText(text) {
        textEl.classList.remove('visible');
        setTimeout(() => { textEl.innerText = text; textEl.classList.add('visible'); }, 1500);
        setTimeout(() => { textEl.classList.remove('visible'); }, 6000);
    }

    function loop() {
        requestAnimationFrame(loop);
        ctx.globalCompositeOperation = 'destination-out';
        ctx.fillStyle = `rgba(0, 0, 0, ${CONFIG.trailLength})`; ctx.fillRect(0, 0, w, h);
        ctx.globalCompositeOperation = 'lighter';
        for(let i=rockets.length-1; i>=0; i--) { rockets[i].draw(ctx); if (!rockets[i].update()) rockets.splice(i, 1); }
        for(let i=particles.length-1; i>=0; i--) { particles[i].draw(ctx); particles[i].update(); if(particles[i].alpha <= 0) particles.splice(i, 1); }
    }
    document.getElementById('start-overlay').addEventListener('click', startShow); loop();
</script>
</body>
</html>